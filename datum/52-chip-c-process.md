---
title: C51
---
# BASE
## DATA TYPE
> C51在标准C的基础上扩展了下面的后4中数据类型，最常见的管教定义sbit LED1=P1^1;以及sfr P1=0X90;P1口定义

DATA-TYPE|BIT|BYTE|RANGE
---------|---|----|----
signed char|8|1|-128~+127，有符号字符变量
unsigned char|8|1|0~255，无符号字符变量
signed int|16|2|-32768~+32767，有符号整数
unsigned int|16|2|0~65535，无符号整数
signed long|32|4|-2147483648~+2147483647，有符号长整型
unsigned long|32|4|0~4294967259，无符号长整型
float|32|4|±3.402823E+38，浮点数（精确到7位）
double|64|8|±1.175494E-308，浮点苏（精确到15位）
*|24|1~3|对象指针
bit|1||0或1
sfr|8|1|0~255
Sfr16|16|2|0~65535
Sbit|1||可进行位寻址的特殊功能寄存器的某位的绝对地址

## 数据存储类型
存储类型|与存储空间的对应关系|数据长度（bit）|值域范围|备注
-------|------------------|--------------|--------|----
data|片内RAM直接寻址区，位于片内RAM的低128B|8|0~255|
bdata|片内RAM位寻址区，位于20H~2FH空间，允许位访问与字节访问|8|0~255|
idata|片内RAM间接寻址的存储区|8|0~255|由MOV @Ri访问
pdata|片外RAM的一个分页寻址区，每页256B|8|0~255|由 MOVX @Ri 访问
xdata|片外RAM全部空间，大小为64KB|16|0~65535|由 MOVX @DPTR 访问
code|程序存储区的64KB空间|16|0~65535|

## period
1. 时钟周期：也称为晶体振荡周期(T)
2. 机器周期：取指令、存储器读、存储器写等为一个基本操作，完成一个基本操作所需要的时间成为机器周期。(nT)
3. 指令周期：是执行一条指令所需要的时间，一般由若干机器周期组成。(mnT)

## AUXR special function register
符号|功能|字节地址|7|6|5|4|3|2|1|0|复位值
----|---|--------|-|-|-|-|-|-|-|-|-|-----
AUXR|辅助寄存器|8EH|T0x12|T1x12|UART_M0x6|BRTR|S2SMOD|BRTx12|EXTRAM|S1BRS|---

+ S1BRS，如果为1那么串口1的波特率发生器为独立波特率发生器，否则为定时器1
+ EXTRAM，为1则可以使用内部扩展RAM
+ BRTx12，为1则独立波特率发生器不分频，否则12分频。
+ S2SMOD，为1串口2波特率加倍，否则不加倍
+ BRTR，为1则允许独立波特率允许，否则不允许。
+ UART_M0x6，为1则串口模式0为2分频，否则为12分频
+ T1x12，为1则定时器1不分频，否则12分频
+ T0x12，为1则定时器0不分频，否则12分频
注意：12分频相当于传统的51单片机的速度

## pointer
+ CP：程序指针，始终指向下一条要执行指令的开始地址
+ DPTR:数据指针
+ SP：堆栈指针，出栈指针先减再出栈。进栈指针先加再进

## interrupt
+ 中断请求（IE0,TF0,IE1,TF1，RI/TI,TF2，IE2，IE3）
+ 中断开关（EX0,ET0,EX1,ET1,ES,ET2,EX2,EX3）
+ 中断总开关(EA)
+ 中断优先级
    + 自然优先级：按中断序号0-7排序，0为最优先
    + 设置优先级：00、01、10、11，11最先
    + 同设置优先级下再以自然优先级排序

## TCON 
符号|功能|字节地址|7|6|5|4|3|2|1|0|复位值
----|---|--------|-|-|-|-|-|-|-|-|-|-----
TCON|C/T控制寄存器|88H|TF1|TR1|TF0|TR0|IE1|IT1|IE0|IT0|---
+ TF1：定时器T1请求标志位。 
+ TR1：定时器T1运行控制位。 
+ TF0：定时器T0溢出标志位。 
+ TR0：定时器T0运行控制位。 
+ IE1：外部中断1请求标志位。 
+ IT1：外部中断1触发方式控制位。 
+ IE0：外部中断0请求标志位。 
+ IT0：外部中断0触发方式控制位。  

控制寄存器TCON的位地址是88H，可以对它进行位寻址。

## TMOD
符号|功能|字节地址|7|6|5|4|3|2|1|0|复位值
----|---|--------|-|-|-|-|-|-|-|-|-|-----
TMOD|T0/T1模式寄存器|89H|GATE|C/T|M1|M0|GATE|C/T|M1|M0|---

+ GATE——门控位
    + 当＝0时，以TR0（或TR1）状态决定定时器/计数器的启动或禁止
    + 当＝1时，以TR0与INT0（或TR1与INT1）状态决定定时器/计数器的启动或禁止    + 
+ C/T＝0 定时/计数工作方式选择位   0为定时器  1为计数器。
+ M1M0——工作方式选择位  
    + M1M0=00    方式0：是13位计数结构的工作方式，其计数器由TH全部8位和TL的低5位构成。
    + M1M0=01    方式1：是16位计数结构的工作方式，计数器由TH全部8位和TL全部8位构成。
    + M1M0=10    方式2：自动装入8位计数器。
    + M1M0=11    方式3：定时器/计数器0被拆成两个独立的8位计数器TL0和TH0。其中TL0既可以计数使用，又可以定时使用，定时器/计数器0的各控制位和引脚信号全归它使用。

## TT2CON
符号|功能|字节地址|7|6|5|4|3|2|1|0|复位值
----|---|--------|-|-|-|-|-|-|-|-|-|-----
T2CON|T2控制|C8H|TF2|EXF2|RCLK|TCLK|EXEN2|TR2|C/T2|C/RL2|---

+ TF2：T2溢出标记
    + 当T2溢出时TF2＝1，TD2只能用软件清除
    + 当RCLK=1或TCLK＝1时，TF2将不置位
+ EXF2：T2外部标记
    + 当EXEN2＝1时，T2EX/P1.1引脚上的负跳变引起T2的捕捉/重装操作，此时EXF2＝1。在T2中断允许时，EXF2＝1将引起中断，EXF2只能用软件清除。在T2的向上、向下计数模式下（DCEN＝1）EXF2的置位将不引起中断。
+ RCLK：接收时钟允许
    + 当RCLK＝1时，T2的溢出脉冲可用作串行口的接收时钟信号，适于串行口模式1、3    
    + 当RCLK＝0时，T1的溢出脉冲用作串行口接收时钟信号
+ TCLK：发送时钟允许
+ EXEN2：T2外部事件（引起捕捉/重装的外部信号）允许
当EXEN2＝1时，如果T2没有作串行时钟输出（即RCLK+TCLK=0），则在T2EX/P1.1引脚跳变将引起T2的捕捉/重装操作；
当EXEN2＝0时，在T2EX引脚的负跳变将不起作用
+ TR2：T2的启动/停止控制  
+ C/T2：计数/定时
+ CP/RL2：捕捉/重装选择
    + 当CP/RL2＝1且EXEN2＝1时，T2EX/P1.1引脚的负跳变将引起捕捉操作
    + 当CP/RL2＝0且EXEN2＝1时，T2EX/P1.1引脚的负跳变将引起重装操作
    + 当CP/RL2＝0且EXEN2＝0时，T2的溢出将引起T2的自动重装操作
    + 当RCLK+TCLK=1时，CP/RL2控制位不起作用，T2被强制工作于重装方式。重装方式发生于T2溢出时，常用来作波特率发生器。

## SCON
符号|功能|字节地址|7|6|5|4|3|2|1|0|复位值
----|---|--------|-|-|-|-|-|-|-|-|-|-----
SCON|串口控制|98H|SM0/FE|SM1|SM2|REN|TB8|RB8|TI|RI|---

+ SM0/FE
    + 当PCON寄存器的SMOD0=1时，该位用于帧错误检测
    + 当PCON寄存器的SMOD0=0时,SMO SM1一起用来选择串口工作方式
+ SM2:多机通信控制位（RB8，TB8完成多机通信）
+ REN:允许串口接收位，有软件置1或清0
+ TB8：发送的第9位数据
+ RB8：接收的第9位数据
+ TI: 发送中断请求标志位
+ RI: 接收中断标志位

## PCON
符号|功能|字节地址|7|6|5|4|3|2|1|0|复位值
----|---|--------|-|-|-|-|-|-|-|-|-|-----
PCON|电源控制|87H|SMOD|SMOD1|-|POF|GF1|GF0|PD|IDL|---

+ SMOD:串口波特率倍速位
+ SMOD0：帧错误检测有效控制位
+ POF: 上电复位标志位，单片机停电后为1，可由软件清0.
+ PD: 掉电模式（只有外部中断继续工作，可由外中断唤醒）
+ IDL: 空闲模式（系统不给CPU提供时钟，CPU不工作，其余都继续工作）
+ GF1、GF0: 两个通用工作标志，用户可任意使用

# 模块化编程
1. 多个.c文件，各自定义实现功能的函数
2. 通过同名的.h文件声明同名.c文件中的函数、变量
3. 通过#include将各.h文件包含到主函数.c文件，主函数文件中即可调用各.c文件中的函数
4. 也可通过extern引入其他.c文件中的变量及函数来共同使用
    extern void Steering_Engine_Control(void);
    extern uint8 Left_Speed;
    extern uint8 Right_Speed;
5. .h文件定义配置，如管脚定义等



